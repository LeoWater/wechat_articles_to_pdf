# wechat_articles_to_pdf
微信公众号文章导出为pdf。 1、爬取任意某个公众号的全部历史文章url并保存到csv文件中。 2、提取csv文件中的url链接，经过处理后，通过pdfkit模块导出带图片的pdf文档。 目前第二步只实现了将单篇公众号文章导出生成带图片的pdf，但没有实现批量一次性将一个公众号的所有文章导出为一个带图片的pdf文档。 邀请各位探讨解决批量导出一个公众号的所有历史文章生成【带图片】pdf文档这个问题。我的公众号【江流】，欢迎后台私戳我交流指教，我会尽快回应。
说明：

目标是爬取微信公众号文章导出为带图片的pdf文档。

1、爬取任意某个公众号的全部历史文章url并保存到csv文件中。

2、提取csv文件中的url链接，经过处理后，通过pdfkit模块导出带图片的pdf文档。

目前第二步只实现了将单篇公众号文章导出生成带图片的pdf，但没有实现批量一次性将一个公众号的所有文章导出为一个带图片的pdf文档。

我实践这个项目的 过程可以参考我的文章《Python从放弃到入门：公众号历史文章爬取为例谈快速学习技能》

[https://mp.weixin.qq.com/s/-5yr0gQoko_DU8N7x1prUA](https://mp.weixin.qq.com/s/-5yr0gQoko_DU8N7x1prUA)

### 生成不带图片的pdf文档半自动程序

文件wechat_articles_to_pdf改.py，实现了通过selenium，进入微信公众平台的超链接，爬取任意某个公众号的历史文章url，将url，标题，日期信息保存至csv文件，并通过pdfkit将这个公众号的历史文章转为一个不带图片的pdf文档。

注意：

本程序为半自动，

1在登陆时自动输入账号密码后显示二维码，此时用手机微信扫二维码。

2在新建图文载入新页面后手动点击页面顶部的”超链接“按钮。

### 根据url导出带图片pdf的问题

思路一

文件csv_url_to_pdf改2难以推进.py，实现了提取csv文件中的某个url地址，通过selenium加载完这个url地址指向的页面，并爬取页面的源代码，将源代码中包含webp的语句替换为空，将替换后的代码保存到txt文件，并改文件后缀html，在将这个html文件传至pdfkit生成带图片的pdf文档。

因为浏览器打开的公众号页面里的图片格式为webp格式，查看源代码发现似乎使用了懒加载，图片所在位置有两个src地址，当浏览器页面滑到图片所在位置时图片才会显示，并且显示的是webp格式图片。经研究发现只需将包含webp属性的src地址去掉webp属性，浏览器加载的图片格式就变为jpg格式了。

我用这个方法实现了转换单篇文章生成带图片的pdf。但是我尝试建立个for循环，让程序每次爬取出页面源代码，并去掉webp属性，添加到txt文件中，生成的txt文件包含这个公众号所有历史文章的源代码，再改变txt文件后缀为html，再传入pdfkit导出带图片的pdf。但是for循环进行了一次之后就报错了。不知道如何解决。并且，即使这个for循环可以继续，生成的txt文件会不会太大，导致pdfkit难以处理也未知。

**期待谁能解决这个问题？**

思路二：是否可以不用selenium，用其他的爬虫框架，直接爬取源代码里未加载图片的那部分代码，但是未加载图片的那部分代码是在哪里，我没找到。我看一些爬虫教程都说在XHR里面，但是我没找到，所以没继续研究这个方向。以及找到了这部分代码后，似乎还要面临导出pdfkit时的困难，似乎还是得改源代码后保存为html文件，再传给pdfkit导出pdf，可能又会遇到思路一中for循环报错的问题。

思路三：我看通过微信pc端进入订阅号，进入某个 订阅号的历史消息，获得的url短链接，打开图文时图片是jpg格式，如果能够批量获得这种短的url，再传给pdfkit应该可以导出带图片的pdf。然而最近通过Filddler抓包，却不知道历史文章的url藏到哪里了。之前有博主说在某个文件的json信息里，现在却没看到，似乎微信给换了个地方。这个思路有待探索尝试。

### 我的两个.py文件的使用方法

1、由于调用了pdfkit，所以要根据你电脑里wkhtmltopdf文件的位置重新指定位置。

2、在代码里nickname，username，password后面填写你的信息，你要导出的公众号名字，你的个人公众号的账号密码。

3、你需要下载和你的chrome浏览器版本对应的chromedriver。可以参考这个链接里的对照表[https://blog.csdn.net/huilan_same/article/details/51896672](https://blog.csdn.net/huilan_same/article/details/51896672)

### 文件csv_url_to_pdf改2难以推进.py的使用说明

本程序可以实现根据某个csv文件，导入某个url链接，生成这篇文章的带图片pdf文档。

中间文件test4.html，成果out2.pdf。每次重新运行本文件时，需要先删除掉或者重命名test4.html和out2.pdf，否则程序会报错。



发布这个项目是希望与大家一起探讨解决问题。没人回应的话，我最近就先学习点别的，过段时间再来攻克微信公众号的问题了。

邀请各位探讨解决批量导出一个公众号的所有历史文章生成【带图片】pdf文档这个问题。我的公众号【江流】，欢迎后台私戳我交流指教或者私戳我移步微信交流，我会尽快回应。

